<!DOCTYPE html>
<html lang="">

<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="UTF-8">

    <title>
        
          計算機組織 - NCTU-Coursenote
        
    </title>

    <!-- Spectre.css framework (v0.5.8) -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- Noto Sans TC -->
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+TC" rel="stylesheet">

    <!-- theme css & js -->
    <link rel="stylesheet" href="/NCTU-Coursenote/css/spectre_custom.css">
    <link rel="stylesheet" href="/NCTU-Coursenote/css/book.css">
    <script src="/NCTU-Coursenote/js/book.js"></script>

    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">

    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- lightgallery.js -->
    
      <script src="https://code.jquery.com/jquery-3.4.0.min.js" integrity="sha256-BJeo0qm959uMBGb65z40ejJYGSgR7REI4+CW1fNKwOg=" crossorigin="anonymous"></script>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.12/css/lightgallery.min.css">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.12/js/lightgallery-all.min.js"></script>
    
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
</head>

<body>

<div class="container">
  <div class="book-container">
    <div class="columns">
      
      <div class="column col-2 book-nav">
        <h4 class="site-meta">
    <a href="/NCTU-Coursenote/">NCTU-Coursenote</a>
</h4>



<div class="sidebar-content">
    
        
            <ul class="book-nav-book"><li><span>大一</span></li></ul>
        
            <ul class="book-nav-book"><li><span>大二</span><ul class="book-nav-book"><li><a href="/NCTU-Coursenote/sophomore/intro-to-formal-language">正規語言概論</a></li></ul><ul class="book-nav-book"><li><a href="/NCTU-Coursenote/sophomore/intro-to-dbms">資料庫系統概論</a></li></ul><ul class="book-nav-book"><li><a href="/NCTU-Coursenote/sophomore/computer-organization">計算機組織</a></li></ul><ul class="book-nav-book"><li><a href="/NCTU-Coursenote/sophomore/signals-and-systems">訊號與系統</a></li></ul><ul class="book-nav-book"><li><a href="/NCTU-Coursenote/sophomore/intro-to-music-theory">音樂理論導論</a></li></ul><ul class="book-nav-book"><li><a href="/NCTU-Coursenote/sophomore/compiler-design">編譯器設計</a></li></ul></li></ul>
        
            <ul class="book-nav-book"><li><span>大三</span></li></ul>
        
            <ul class="book-nav-book"><li><span>大四</span></li></ul>
        
    
</div>

<script>
document.querySelectorAll('.sidebar-content a').forEach(function(item){ 
    if(item.href === window.location.href || item.href === window.location.href.slice(0, -1)) {
        item.className = "book-nav-current"
    }
})
</script>
      </div>

      <div class="column col-10">
        <div class="book-content">
          <div class="columns">
  <div class="column col-10">
    <div class="book-post">
      <h1 id="計算機組織">計算機組織</h1>
<h2 id="1-computer-abstractions-and-technology">1. Computer Abstractions and Technology</h2>
<h3 id="abstractions-architecture">Abstractions architecture</h3>
<p><img src="/NCTU-Coursenote/img/computer-organization/2019-04-17-21-22-13.png" alt></p>
<p>ISA: Instruction set architecture (The hardware/software interface)</p>
<h3 id="trade-off">Trade-off</h3>
<h4 id="power-trends">Power Trends</h4>
<div>$$
Power = Capacitive \, load \times Voltage^2 \times Frequency
$$</div>
<h4 id="integrated-circuit-cost">Integrated Circuit Cost</h4>
<div>$$
Cost \, per \, die = \frac{ Cost \, per \, wafer }{ Dies \, per \, wafer * Yield}
$$</div>
<div>$$
Dies \, per \, wafer \approx \frac{Wafer \, area}{Die \, area}
$$</div>
<div>$$
Yield = \frac{1}{(1 + (Defects \, per \, area * Die \, area / 2))^2}
$$</div>
<h3 id="performance">Performance</h3>
<h4 id="relative-performance">Relative Performance</h4>
<div>$$
Performance = \frac{1}{Execution \, Time}
$$</div>
<p>e.g. X is n time faster than Y</p>
<div>$$
\frac{Performance_X}{Performance_Y} = \frac{Execution \, time_Y}{Execution \, time_X} = n
$$</div>
<h4 id="response-time-and-throughput">Response Time and Throughput</h4>
<ul>
<li><strong>Response time</strong>(Elapsed time): The time it takes to do a task（<strong>要完成一件工作，所需花費的時間</strong>）
<ul>
<li>including all aspects (Processing, I/O, OS overhead, idle time)</li>
<li>Determines system performance</li>
</ul>
</li>
<li><strong>Throughput</strong>: Total work done per unit time（<strong>在一定時間內，所能完成的工作量</strong>）
<ul>
<li>e.g., tasks/transactions/… per hour</li>
</ul>
</li>
</ul>
<h4 id="cpu-clocking">CPU Clocking</h4>
<p><img src="/NCTU-Coursenote/img/computer-organization/2019-04-17-21-33-51.png" alt></p>
<ul>
<li>Clock period: duration of a clock cycle（一個 Cycle 花費的時間）
<ul>
<li>e.g., 250ps = 0.25ns = 250×10 –12 s</li>
</ul>
</li>
<li>Clock frequency (rate): cycles per second（一秒幾個 Cycle）
<ul>
<li>e.g., 4.0GHz = 4000MHz = 4.0×10 9 Hz</li>
</ul>
</li>
</ul>
<h4 id="cpu-time">CPU time</h4>
<p><strong>CPU處理給定的工作所花費的時間</strong> (Discounts I/O time, other jobs’ shares)</p>
<div>$$
CPU \, Time = Clock \, Cycles \times Clock \, Cycle \, Time = \frac{CPU \, Clock \, Cycles}{Clock \, Rate}
$$</div>
<p>公式理解：<strong>處理工作時走了幾個 Cycle</strong> 乘上<strong>每走一個 Cycle 所要花費的時間</strong></p>
<ul>
<li>Performance improved by
<ul>
<li>Reducing number of clock cycles</li>
<li>Increasing clock rate</li>
<li>Hardware designer must often trade off clock rate against cycle count</li>
</ul>
</li>
</ul>
<h4 id="cycles-per-instruction-cpi">Cycles per Instruction (CPI)</h4>
<p><strong>每執行一個指令(Instruction)，所要花費的 Cycle</strong></p>
<div>$$
Clock \, Cycles = Instruction \, Count \times Cycles \, per \, Instruction
$$</div>
<ul>
<li>Instruction Count for a program
<ul>
<li>Determined by program, ISA and compiler</li>
</ul>
</li>
<li>Average cycles per instruction
<ul>
<li>Determined by CPU hardware</li>
</ul>
</li>
</ul>
<p>CPU Time 可以改寫為：</p>
<div>$$
CPU \, Time = Instruction \, Count \times CPI \times Clock \, Cycle \, Time = \frac{Instruction \, Count \times CPI}{Clock \, Rate}
$$</div>
<p>If different instruction classes take different numbers of cycles</p>
<div>$$
Clock \, Cycles = \sum_{i=1}^{n} (CPI_i \times Instruction \, Count_i)
$$</div>
<p>Weighted average CPI</p>
<div>$$
CPI = \frac{Clock \, Cycles}{Instruction \, Count} = \sum_{i=1}^{n}(\frac{CPI_i \times Instruction \, Count_i}{Instruction \, Count})
$$</div>
<h4 id="performance-summary">Performance Summary</h4>
<div>$$
CPI = \frac{Instructions}{Program} \times \frac{Clock \, cycles}{Instruction} \times \frac{Seconds}{Clock \, cycle}
$$</div>
<ul>
<li>Performance depends on
<ul>
<li>Algorithm: <strong>affects IC</strong>, possibly CPI</li>
<li>Programming language: <strong>affects IC, CPI</strong></li>
<li>Compiler: <strong>affects IC, CPI</strong></li>
<li>Instruction set architecture: <strong>affects IC, CPI, Tc</strong></li>
</ul>
</li>
</ul>
<h3 id="amdahl-s-law"><a href="https://en.wikipedia.org/wiki/Amdahl%27s_law" target="_blank" rel="noopener">Amdahl’s Law</a></h3>
<p>Improving an aspect of a computer and expecting a proportional improvement in overall performance</p>
<div>$$
T_{improved} = \frac{T_{affected}}{Improvement \, factor} + T_{unaffected}
$$</div>
<h3 id="mips">MIPS</h3>
<p>Millions of Instructions Per Second</p>
<div>$$
MIPS = \frac{Instruction \, count}{Execution \, time \times 10^6} = \frac{Instruction \, count}{\frac{Instruction \, count \times CPI}{Clock \, rate} \times 10^6} = \frac{Clock rate}{CPI \times 10^6}
$$</div>
<blockquote>
<p>ps: MIPS無法拿來當作電腦效能的依據（<strong>因為沒有考慮到 Instruction Count</strong>）</p>
</blockquote>
<h2 id="2-instructions-language-of-the-computer">2. Instructions: Language of the Computer</h2>
<p>以下皆以 MIPS Instruction Set 為例子</p>
<h3 id="design-principle">Design Principle</h3>
<ol>
<li>Simplicity favours regularity（MIPS Instruction 的 Format 都相近）</li>
<li>Smaller is faster（越少 Register 就越少電路）</li>
<li>Make the common case fast（e.g. addi vs add，減少 Load instruction)</li>
<li>Good design demands good compromises（根據需求有不同的format，但都是32bit且各個format盡量相似）</li>
</ol>
<h3 id="register-usage">Register Usage</h3>
<table>
<thead>
<tr>
<th>Register Number</th>
<th>Conventional Name</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>$0</td>
<td>$zero</td>
<td>Hard-wired to 0</td>
</tr>
<tr>
<td>$1</td>
<td>$at</td>
<td>Reserved for pseudo-instructions</td>
</tr>
<tr>
<td>$2 - $3</td>
<td>$v0, $v1</td>
<td>Return values from functions</td>
</tr>
<tr>
<td>$4 - $7</td>
<td>$a0 - $a3</td>
<td>Arguments to functions - not preserved by subprograms</td>
</tr>
<tr>
<td><strong>$8 - $15</strong></td>
<td><strong>$t0 - $t7</strong></td>
<td>Temporary data, not preserved by subprograms</td>
</tr>
<tr>
<td><strong>$16 - $23</strong></td>
<td><strong>$s0 - $s7</strong></td>
<td>Saved registers, preserved by subprograms</td>
</tr>
<tr>
<td><strong>$24 - $25</strong></td>
<td><strong>$t8 - $t9</strong></td>
<td>More temporary registers, not preserved by subprograms</td>
</tr>
<tr>
<td>$26 - $27</td>
<td>$k0 - $k1</td>
<td>Reserved for kernel. Do not use.</td>
</tr>
<tr>
<td>$28</td>
<td>$gp</td>
<td>Global Area Pointer (base of global data segment)</td>
</tr>
<tr>
<td><strong>$29</strong></td>
<td><strong>$sp</strong></td>
<td>Stack Pointer</td>
</tr>
<tr>
<td><strong>$30</strong></td>
<td><strong>$fp</strong></td>
<td>Frame Pointer</td>
</tr>
<tr>
<td><strong>$31</strong></td>
<td><strong>$ra</strong></td>
<td>Return Address</td>
</tr>
<tr>
<td>$f0 - $f3</td>
<td>-</td>
<td>Floating point return values</td>
</tr>
<tr>
<td>$f4 - $f10</td>
<td>-</td>
<td>Temporary registers, not preserved by subprograms</td>
</tr>
<tr>
<td>$f12 - $f14</td>
<td>-</td>
<td>First two arguments to subprograms, not preserved by subprograms</td>
</tr>
<tr>
<td>$f16 - $f18</td>
<td>-</td>
<td>More temporary registers, not preserved by subprograms</td>
</tr>
<tr>
<td>$f20 - $f31</td>
<td>-</td>
<td>Saved registers, preserved by subprograms</td>
</tr>
</tbody>
</table>
<h3 id="format">Format</h3>
<h4 id="r-format-register">R-format (Register)</h4>
<table>
<thead>
<tr>
<th>op</th>
<th>rs</th>
<th>rt</th>
<th>rd</th>
<th>shamt</th>
<th>funct</th>
</tr>
</thead>
<tbody>
<tr>
<td>6 bits</td>
<td>5 bits</td>
<td>5 bits</td>
<td>5 bits</td>
<td>5 bits</td>
<td>6 bits</td>
</tr>
</tbody>
</table>
<ul>
<li>op: operation code (opcode)</li>
<li>rs: first source register number</li>
<li>rt: second source register number</li>
<li>rd: destination register number</li>
<li>shamt: shift amount (00000 for now)</li>
<li>funct: function code (extends opcode)</li>
</ul>
<p>example) add $t0, $s1, $s2</p>
<table>
<thead>
<tr>
<th>op</th>
<th>rs</th>
<th>rt</th>
<th>rd</th>
<th>shamt</th>
<th>funct</th>
</tr>
</thead>
<tbody>
<tr>
<td>special</td>
<td>$s1</td>
<td>$s2</td>
<td>$t0</td>
<td>0</td>
<td>add</td>
</tr>
<tr>
<td>0</td>
<td>17</td>
<td>18</td>
<td>8</td>
<td>0</td>
<td>32</td>
</tr>
<tr>
<td>000000</td>
<td>10001</td>
<td>10010</td>
<td>01000</td>
<td>00000</td>
<td>100000</td>
</tr>
</tbody>
</table>
<div>$$
000000|10001|10010|01000|00000|100000_2 = 02324020_{16}
$$</div>
<h4 id="i-format-immediate">I-format (Immediate)</h4>
<table>
<thead>
<tr>
<th>op</th>
<th>rs</th>
<th>rt</th>
<th>constant or address</th>
</tr>
</thead>
<tbody>
<tr>
<td>6 bits</td>
<td>5 bits</td>
<td>5 bits</td>
<td>16 bits</td>
</tr>
</tbody>
</table>
<ul>
<li>Immediate arithmetic and load/store instructions</li>
<li>rt: Target Register</li>
<li>Constant: <code>$-2^{15} ~ +2^{15} - 1$</code></li>
<li>Address: offset added to base address in rs</li>
</ul>
<p>example) addi $t0, $s1, -50</p>
<table>
<thead>
<tr>
<th>op</th>
<th>rs</th>
<th>rt</th>
<th>constant or address</th>
</tr>
</thead>
<tbody>
<tr>
<td>8</td>
<td>$s1</td>
<td>$t0</td>
<td>-50</td>
</tr>
<tr>
<td>8</td>
<td>17</td>
<td>8</td>
<td>-50</td>
</tr>
<tr>
<td>001000</td>
<td>10001</td>
<td>01000</td>
<td>11111111 11001110</td>
</tr>
</tbody>
</table>
<div>$$
001000|10001|01000|1111111111001110_2
$$</div>
<h4 id="j-format-jump">J-format (Jump)</h4>
<table>
<thead>
<tr>
<th>op</th>
<th>address</th>
</tr>
</thead>
<tbody>
<tr>
<td>6 bits</td>
<td>26 bits</td>
</tr>
</tbody>
</table>
<h3 id="addressing">Addressing</h3>
<h4 id="immediate-addressing">Immediate Addressing</h4>
<p>運算元是常數,且包裝在指令內部</p>
<p><img src="/NCTU-Coursenote/img/computer-organization/2019-04-18-02-14-12.png" alt></p>
<h4 id="register-addressing">Register Addressing</h4>
<p>運算元是暫存器</p>
<p><img src="/NCTU-Coursenote/img/computer-organization/2019-04-18-02-11-37.png" alt></p>
<h4 id="base-addressing">Base Addressing</h4>
<p>運算元存放在記憶體中,而位址本身是暫存器和指令中常數的和</p>
<p><img src="/NCTU-Coursenote/img/computer-organization/2019-04-18-02-12-16.png" alt></p>
<h4 id="pc-relative-addressing">PC-relative Addressing</h4>
<p>位址是 PC 和指令中常數的加總</p>
<p><img src="/NCTU-Coursenote/img/computer-organization/2019-04-18-02-13-43.png" alt></p>
<h4 id="pseduodirect-addressing">Pseduodirect Addressing</h4>
<p>跳躍位址是指令的 26 位元再加上 PC 較高的位元</p>
<p><img src="/NCTU-Coursenote/img/computer-organization/2019-04-18-02-13-19.png" alt></p>
<h3 id="branch-addressing">Branch Addressing</h3>
<p>PC: Program Counter</p>
<p>See: <a href="https://www.youtube.com/watch?v=1bP6alXjDrw" target="_blank" rel="noopener">ISA 2.4 MIPS: Addresses in branches and jumps</a></p>
<h4 id="conditional-branch">Conditional Branch</h4>
<p>根據比較結果改變程式流向，用 I-format (e.g. beq rs, rt, imm)</p>
<p>由於所有指令在記憶體中都是 4bytes 對齊的（一定都是 4 的倍數），最後 2 個 bit 沒有必要存，所以都是 0</p>
<p><img src="/NCTU-Coursenote/img/computer-organization/2019-04-18-02-03-58.png" alt></p>
<h4 id="unconditional-branch">Unconditional Branch</h4>
<p>直接 jump 到指定的 Address 上</p>
<p><img src="/NCTU-Coursenote/img/computer-organization/2019-04-18-02-05-12.png" alt></p>
<h3 id="procedure-call">Procedure Call</h3>
<h4 id="leaf-procedure">Leaf Procedure</h4>
<p>See:</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=NjWZxz0GqFM" target="_blank" rel="noopener">ISA 2.7 MIPS: Procedures and jal</a></li>
<li><a href="https://www.youtube.com/watch?v=xPx5qdMaK9k" target="_blank" rel="noopener">ISA 2.8 MIPS Procedure call in detail (example)</a></li>
</ul>
<h4 id="non-leaf-procedure">Non-Leaf Procedure</h4>
<p>Using stack to restore back registers</p>
<p>See:</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=y9Wv1RVbbNA" target="_blank" rel="noopener">ISA 2.9 MIPS: Saving and restoring registers to the stack</a></li>
<li><a href="https://www.youtube.com/watch?v=gbHagOGOfLc" target="_blank" rel="noopener">ISA 2.10 Procedure Calls: Saving Registers (example 1)</a></li>
<li><a href="https://www.youtube.com/watch?v=iST9dQolhHE" target="_blank" rel="noopener">ISA 2.11 Procedure Calls: Saving registers (example 2)</a></li>
<li><a href="https://www.youtube.com/watch?v=TYSYDrE4moE" target="_blank" rel="noopener">ISA 2.12 Procedure call summary</a></li>
</ul>
<h3 id="synchronization">Synchronization</h3>
<p>兩個 procedure 對同一個 share variable 讀取寫入時，需要一個機制來協調兩者</p>
<p>See:</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=QPpTBjf4Yrk" target="_blank" rel="noopener">計算機組織 Chapter 2.10 Synchronization - Load link &amp; Store conditional instructions - 朱宗賢老師</a></li>
</ul>
<h2 id="3-arithmetic-for-computers">3. Arithmetic for Computers</h2>
<h3 id="multiplication">Multiplication</h3>
<ul>
<li><a href="https://www.youtube.com/watch?v=IeRm--sokdg" target="_blank" rel="noopener">12. Implementing Multiplication</a></li>
<li><a href="https://www.youtube.com/watch?v=-QghzKWAZ6o" target="_blank" rel="noopener">12-1. Improving the Multiplication Hardware</a></li>
</ul>
<h4 id="booth-s-algorithm">Booth’s Algorithm</h4>
<p><a href="https://www.youtube.com/watch?v=qVmZ-mZnYTI" target="_blank" rel="noopener">Booth’s algorithm - Binary multiplication example | Computer Organization</a></p>
<h3 id="division">Division</h3>
<ul>
<li><a href="https://www.youtube.com/watch?v=gNEm5QCe0eU" target="_blank" rel="noopener">13. Implementing Division</a></li>
<li><a href="https://www.youtube.com/watch?v=7m6I7_3XdZ8" target="_blank" rel="noopener">13-1. Improving the Division Hardware</a></li>
</ul>
<h3 id="floating-point">Floating Point</h3>
<p>待補</p>
<h4 id="ieee-754">IEEE 754</h4>
<p><a href="https://www.youtube.com/watch?v=oaf4v4wOuGI" target="_blank" rel="noopener">Computer Science Concepts: IEEE 754 - Learn Freely</a></p>
<h2 id="ch4">Ch4</h2>
<h3 id="p26">p26</h3>
<p>Store:</p>
<p>RegWrite - 0<br>
ALUSrc - 1 (引進constant)<br>
MemWrite - 1<br>
MemRead - 0<br>
MemtoReg - don’t care</p>
<h3 id="p52">p52</h3>
<p>分 4 類<br>
lw, sw, beq, r-type<br>
由 second level gen 出 ALU signal<br>
(讀 10 要再讀 funct field)</p>
<h3 id="p59">p59</h3>
<p>ALU_ctrl = ALUOp + Instruction[5:0]</p>
<h1 id="buttom">Buttom</h1>

    </div>
    
    <div id="disqus_thread"></div>
    <script>
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://at881005.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  </div>
  <div class="column col-2">
    <div class="book-toc">
      <div class="book-tocbot">
      </div>
      <div class="book-tocbot-menu">
        <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
      </div>
    </div>
  </div>
</div>

<script>
tocbot.init({
  tocSelector: '.book-tocbot',
  contentSelector: '.book-post',
  headingSelector: 'h1, h2, h3, h4, h5',
  collapseDepth: 2,
  orderedList: false,
  scrollSmooth: false,
});

function expand_toc(){
  var b = document.querySelector(".book-toc-expand");
  tocbot.init({
    tocSelector: '.book-tocbot',
    contentSelector: '.book-post',
    headingSelector: 'h1, h2, h3, h4, h5',
    collapseDepth: 6,
    orderedList: false,
    scrollSmooth: false,
  });
  b.setAttribute("onclick", "collapse_toc()");
  b.innerHTML = "Collapse all"
}

function collapse_toc(){
  var b = document.querySelector(".book-toc-expand");
  tocbot.init({
    tocSelector: '.book-tocbot',
    contentSelector: '.book-post',
    headingSelector: 'h1, h2, h3, h4, h5',
    collapseDepth: 2,
    orderedList: false,
    scrollSmooth: false,
  });
  b.setAttribute("onclick", "expand_toc()");
  b.innerHTML = "Expand all"
}

function go_top() {
  window.scrollTo(0, 0);
}

function go_bottom() {
  window.scrollTo(0, document.body.scrollHeight);
}

</script>


<script>
  $('.book-content img').each(function () {
      $(this).wrap("<a href='" + this.src + "'>").parent('a').addClass('gallery-item');
  })
  $(document).ready(function() {
    $(".book-content").lightGallery({
        selector: '.gallery-item'
    });
  });
</script>

        </div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
